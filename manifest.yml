---
applications:
  - name: imc-db-server
    path: ./target/imc-db-server-3.0.0.jar
    memory: 1G
    instances: 1
    buildpacks:
      - java_buildpack_offline
    env:
      JBP_CONFIG_OPEN_JDK_JRE: '{ jre: { version: 21.+ } }'
      SPRING_PROFILES_ACTIVE: cloud
      JBP_CONFIG_SPRING_AUTO_RECONFIGURATION: '{enabled: false}'
      JVM_HEAP_RATIO: 0.65
      JAVA_OPTS: '-Xmx650m -Xss1M -XX:ReservedCodeCacheSize=240M -XX:MaxMetaspaceSize=200M -XX:+UseG1GC'
      # Database configuration - will be overridden by build script
      DB01_HOST: "PLACEHOLDER_HOST"
      DB01_PORT: "PLACEHOLDER_PORT"
      DB01_DATABASE: "PLACEHOLDER_DATABASE"
      DB01_USER: "PLACEHOLDER_USER"
      DB01_PASSWORD: "PLACEHOLDER_PASSWORD"
    services:
      # Uncomment and configure if using CF database services
      # - greenplum-db01
      - imc-services  # Spring Cloud Service Registry
    health-check-type: http
    health-check-http-endpoint: /actuator/health
    health-check-invocation-timeout: 30
    timeout: 180
    # Routes will be set dynamically by build script
    # using cf domains to get the available domain